<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wilderness Essentials UK | Best Camping Gear 2024</title>
    <link rel="icon" type="image/jpeg" href="logo-wilderness-essentials-uk.jpg">
    <style>
        :root {
            --logo-green: #3c5a36;
            --logo-brown: #6b4a2b;
            --logo-gold: #c9a14a;
            --primary: #3c5a36;
            --secondary: #6b4a2b;
            --accent: #c9a14a;
            --bg-pastel: #f6f7f2;
            --header-text: #3c5a36;
            --card-shadow: 0 8px 32px rgba(60,90,54,0.09), 0 1.5px 6px rgba(105,74,43,0.08);
            --card-shadow-hover: 0 12px 36px rgba(60,90,54,0.13), 0 4px 16px rgba(105,74,43,0.12);
            --border-radius: 18px;
        }
        html, body {
            font-size: 16px;
        }
        body {
            font-family: 'Segoe UI', Arial, 'Amazon Ember', Verdana, sans-serif;
            background: var(--bg-pastel);
            color: var(--logo-brown);
            margin: 0;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }
        .background-float {
            position: fixed;
            right: 0;
            bottom: 0;
            top: 0;
            left: 0;
            z-index: 0;
            pointer-events: none;
            background: url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1200&q=80') no-repeat right bottom;
            background-size: cover;
            opacity: 0.07;
            filter: blur(0.5px) grayscale(0.3) brightness(1.1);
        }
        .layout {
            display: flex;
            min-height: 100vh;
            position: relative;
            z-index: 1;
        }
        .sidebar {
            width: 250px;
            background: #fff;
            border-right: 2px solid var(--logo-gold);
            padding: 2rem 1rem 1rem 1rem;
            box-shadow: 2px 0 14px rgba(60,90,54,0.08);
            position: sticky;
            top: 0;
            min-height: 100vh;
            z-index: 200;
            height: 100vh;
            overflow-y: auto;
            overflow-x: hidden; /* Prevent horizontal scroll in sidebar */
        }
        .sidebar h2 {
            font-size: 1.2rem;
            color: var(--logo-green);
            margin-top: 0;
            margin-bottom: 1rem;
        }
        .sidebar-menu,
        .sidebar-submenu {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .sidebar-menu > li {
            margin-bottom: 0.6em;
        }
        .sidebar-parentcat {
            display: block;
            width: 100%;
            background: var(--logo-green);
            color: #fff;
            font-weight: 700;
            font-size: 1.08rem;
            text-align: left;
            padding: 0.5em 0.7em;
            border-radius: 8px;
            margin-bottom: 0.12em;
            border: none;
            cursor: default;
            letter-spacing: 0.01em;
            outline: none;
            pointer-events: none;
            box-shadow: none;
            opacity: 1;
            white-space: normal; /* Allow wrapping of long names */
            overflow: visible;
        }
        .sidebar-link, .sidebar-sublink {
            display: block;
            width: 100%;
            background: none;
            border: none;
            color: var(--logo-green);
            font-weight: 600;
            font-size: 1.04rem;
            text-align: left;
            padding: 0.4em 0.7em;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.18s, color 0.18s;
            text-decoration: none;
            margin-bottom: 0.12em;
            white-space: normal; /* Allow wrapping */
            overflow: visible;
        }
        .sidebar-link.active,
        .sidebar-link:hover {
            background: var(--accent);
            color: #fff;
        }
        .sidebar-submenu {
            margin-left: 0.6em;
            margin-top: 0.2em;
        }
        .sidebar-sublink {
            color: var(--logo-brown);
            font-weight: 500;
            font-size: 0.98rem;
            border-radius: 5px;
            padding: 0.34em 0.7em;
            background: none;
            white-space: normal;
        }
        .sidebar-sublink.active,
        .sidebar-sublink:hover {
            background: var(--logo-gold);
            color: #fff;
        }
        .sidebar-toggle-btn {
            display: none;
            position: fixed;
            left: 15px;
            top: 15px;
            z-index: 300;
            background: var(--logo-gold);
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 0.6em 1em;
            font-size: 1.2em;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(60,90,54,0.10);
        }
        @media (max-width: 950px) {
            .sidebar {
                position: fixed;
                left: -265px;
                top: 0;
                height: 100vh;
                min-height: 100vh;
                z-index: 2000;
                transition: left 0.28s;
            }
            .sidebar.open {
                left: 0;
                box-shadow: 2px 0 15px rgba(60,90,54,0.14);
            }
            .sidebar-toggle-btn {
                display: block;
            }
            .layout {
                flex-direction: column;
            }
        }
        .main-content {
            flex: 1 1 auto;
            padding: 0;
        }
        header {
            background: transparent;
            color: var(--header-text);
            padding: 0 0 1.5rem 0;
            text-align: center;
        }
        header h1 {
            margin: 0 0 0.3rem 0;
            font-size: 2.1rem;
            color: var(--logo-green);
            font-weight: 700;
            letter-spacing: 0.02em;
        }
        .site-tagline {
            color: var(--secondary);
            font-size: 1.07rem;
            margin: 0.6rem auto 0 auto;
            max-width: 670px;
            line-height: 1.7;
            background: #fff8ee;
            border-radius: 13px;
            padding: 1.1rem 1.5rem 1.1rem 1.5rem;
            box-shadow: 0 1px 7px rgba(201,161,74,0.06);
        }
        .site-logo {
            display: block;
            margin: 0 auto 1.1rem auto;
            max-width: 120px;
            width: 100%;
            height: auto;
            border-radius: 14px;
            box-shadow: 0 2px 8px rgba(60,90,54,0.07);
            background: #fff;
            padding: 10px;
        }
        @media (max-width: 600px) {
            .site-logo {
                max-width: 90px;
            }
            .site-tagline {
                font-size: 0.99rem;
                padding: 0.8rem 0.7rem;
            }
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 1rem;
            position: relative;
            z-index: 1;
        }
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2.5rem 2rem;
            align-items: stretch;
            justify-items: center;
        }
        .product-card-link {
            text-decoration: none;
            color: inherit;
            display: block;
            width: 100%;
            max-width: 420px;
            min-width: 0;
            min-height: 430px;
        }
        .product-card {
            background: #fff;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            display: flex;
            flex-direction: column;
            width: 100%;
            min-width: 0;
            min-height: 430px;
            transition: box-shadow 0.24s, transform 0.18s;
            overflow: hidden;
            border: 1.5px solid #ece7e1;
            position: relative;
            cursor: pointer;
        }
        .product-card:hover, .product-card-link:focus .product-card {
            box-shadow: var(--card-shadow-hover);
            border-color: var(--logo-gold);
            transform: translateY(-5px) scale(1.012);
        }
        .product-image-container {
            width: 100%;
            height: 220px;
            background: #faf8f3;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 24px 10px 18px 10px;
            box-sizing: border-box;
            border-bottom: 1px solid #f2ecdf;
        }
        .product-image {
            max-width: 100%;
            max-height: 100%;
            height: auto;
            width: auto;
            object-fit: contain;
            display: block;
            background: #fff;
            border-radius: 11px;
            box-shadow: 0 1px 5px rgba(60,90,54,0.06);
        }
        .product-info {
            flex: 1 1 auto;
            padding: 1.2rem 1.2rem 1.6rem 1.2rem;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            min-height: 180px;
            position: relative;
        }
        .product-title {
            font-size: 1.15rem;
            font-weight: bold;
            color: var(--logo-green);
            margin-bottom: 0.7rem;
            min-height: 2.2em;
            line-height: 1.3;
            text-overflow: ellipsis;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            letter-spacing: 0.01em;
        }
        .product-desc {
            font-size: 1.03rem;
            color: var(--logo-brown);
            margin-bottom: 1.1rem;
            flex: 1 1 auto;
            line-height: 1.51;
            min-height: 5em;
            white-space: pre-line;
        }
        .more-info-btn {
            margin: auto 1rem 0 1rem;
            background: var(--logo-green);
            color: #fff;
            text-decoration: none;
            padding: 0.72rem 1.3rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1.05rem;
            text-align: center;
            cursor: pointer;
            transition: background 0.18s, box-shadow 0.18s;
            box-shadow: 0 1px 5px rgba(60,90,54,0.08);
            display: block;
            width: calc(100% - 2rem);
            box-sizing: border-box;
            letter-spacing: 0.01em;
            position: relative;
            z-index: 2;
        }
        .more-info-btn:hover, .more-info-btn:focus {
            background: var(--accent);
            color: var(--logo-brown);
        }
        .product-card-link:focus .more-info-btn,
        .product-card-link:active .more-info-btn {
            outline: 2px solid var(--accent);
        }
        /* Hide sidebar by default on mobile */
        @media (max-width: 950px) {
            .main-content {
                padding: 0;
            }
            .sidebar {
                position: fixed;
                left: -265px;
                top: 0;
                height: 100vh;
                min-height: 100vh;
                z-index: 2000;
                transition: left 0.28s;
            }
            .sidebar.open {
                left: 0;
                box-shadow: 2px 0 15px rgba(60,90,54,0.14);
            }
            .sidebar-toggle-btn {
                display: block;
            }
            .layout {
                flex-direction: column;
            }
        }
        /* Overlay for mobile menu */
        .sidebar-overlay {
            display: none;
            position: fixed;
            left: 0; top: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(60,90,54,0.22);
            z-index: 1000;
        }
        .sidebar.open ~ .sidebar-overlay {
            display: block;
        }
    </style>
</head>
<body>
    <div class="background-float" aria-hidden="true"></div>
    <button id="sidebarToggle" class="sidebar-toggle-btn" aria-label="Open menu">☰ Menu</button>
    <div class="layout">
        <nav class="sidebar" id="sidebar" aria-label="Categories"></nav>
        <div class="sidebar-overlay" id="sidebarOverlay"></div>
        <div class="main-content">
            <header>
                <img src="logo-wilderness-essentials-uk.jpg" alt="Wilderness Essentials UK Logo" class="site-logo" />
                <h1>Wilderness Essentials UK</h1>
                <div class="site-tagline">
                    Embark on your next adventure with confidence, equipped by Wilderness Essentials UK. We offer a meticulously curated selection of high-quality camping gear, hiking essentials, and outdoor equipment specifically chosen for the diverse landscapes of the United Kingdom.<br><br>
                    From robust tents and comfortable sleeping bags to efficient cookware, reliable backpacks, and essential bushcraft tools, find everything you need to thrive in the British wilderness. Explore our range designed for durability, performance, and unforgettable outdoor experiences.
                </div>
            </header>
            <main class="container">
                <div class="products-grid" id="productsGrid"></div>
            </main>
            <p style="text-align:center;font-size:0.95em;color:#aaa;margin:2em 0 1em 0;">2025 Wilderness Essentials UK © All Rights Reserved.</p>
        </div>
    </div>
    <script>
        const SHEET_ID = "1w6NcZ9OPhjLcZtgK98ypsxM9eV13NLT9hOf4AVe5HR4";
        const API_KEY = "AIzaSyABNGnLmTXlik5fgBe_ooBI1Y5nrXKTePY";
        const RANGE = "Sheet1";
        let allProducts = [];
        let categoryMap = {};
        let currentMainCat = '';
        let currentSubCat = '';

        // Sidebar toggle for mobile
        function setupSidebarToggle() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            const toggle = document.getElementById('sidebarToggle');
            function openSidebar() {
                sidebar.classList.add('open');
                overlay.style.display = 'block';
                document.body.style.overflow = 'hidden';
            }
            function closeSidebar() {
                sidebar.classList.remove('open');
                overlay.style.display = 'none';
                document.body.style.overflow = '';
            }
            toggle.onclick = openSidebar;
            overlay.onclick = closeSidebar;
            sidebar.onclick = function(e) {
                if(window.innerWidth <= 950 && (e.target.classList.contains('sidebar-link') || e.target.classList.contains('sidebar-sublink'))) {
                    closeSidebar();
                }
            };
            window.addEventListener('resize', () => {
                if(window.innerWidth > 950) closeSidebar();
            });
        }

        async function fetchProducts() {
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=${API_KEY}`;
            try {
                const response = await fetch(url);
                const data = await response.json();
                if (!data.values) {
                    throw new Error(data.error ? data.error.message : 'No data returned');
                }
                const [headers, ...rows] = data.values;
                allProducts = rows.map(row => {
                    const p = {};
                    headers.forEach((h, i) => p[h] = row[i] || "");
                    let [main, sub] = (p.category || '').split('>').map(x => x.trim());
                    p.mainCat = main || '';
                    p.subCat = sub || '';
                    return p;
                });
                buildCategoryMap();
                buildSidebar();
                renderProducts(); // Show prompt to select
            } catch (err) {
                const grid = document.getElementById('productsGrid');
                if (grid) {
                    grid.innerHTML = `<div style="color:red;text-align:center;">Failed to load products: ${err.message}</div>`;
                }
                console.error(err);
            }
        }

        function buildCategoryMap() {
            categoryMap = {};
            allProducts.forEach(p => {
                if (!p.mainCat) return;
                if (!categoryMap[p.mainCat]) categoryMap[p.mainCat] = new Set();
                if (p.subCat) categoryMap[p.mainCat].add(p.subCat);
            });
            for (let main in categoryMap) {
                categoryMap[main] = Array.from(categoryMap[main]);
            }
        }

        function buildSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.innerHTML = `<h2>Categories</h2>`;
            const menu = document.createElement('ul');
            menu.className = 'sidebar-menu';

            Object.entries(categoryMap).forEach(([main, subcats]) => {
                const mainLi = document.createElement('li');
                // Parent cat is always non-selectable (styled as heading)
                const mainBtn = document.createElement('div');
                mainBtn.className = 'sidebar-parentcat';
                mainBtn.textContent = main;
                mainLi.appendChild(mainBtn);

                // Subcats (expand all)
                if (subcats.length > 0) {
                    const subList = document.createElement('ul');
                    subList.className = 'sidebar-submenu';
                    subcats.forEach(sub => {
                        const subBtnLi = document.createElement('li');
                        const subBtn = document.createElement('button');
                        subBtn.className = 'sidebar-sublink' + (currentMainCat === main && currentSubCat === sub ? ' active' : '');
                        subBtn.textContent = sub;
                        subBtn.onclick = function(e) {
                            e.preventDefault();
                            currentMainCat = main;
                            currentSubCat = sub;
                            renderProducts();
                        };
                        subBtnLi.appendChild(subBtn);
                        subList.appendChild(subBtnLi);
                    });
                    mainLi.appendChild(subList);
                }
                menu.appendChild(mainLi);
            });
            sidebar.appendChild(menu);
        }

        function renderProducts() {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = '';

            let filtered = [];
            if (currentMainCat && currentSubCat) {
                filtered = allProducts.filter(p => p.mainCat === currentMainCat && p.subCat === currentSubCat);
            }

            // Update sidebar active states
            document.querySelectorAll('.sidebar-sublink').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.sidebar-menu > li').forEach(li => {
                li.querySelectorAll('.sidebar-parentcat').forEach(btn => btn.classList.remove('active'));
            });
            document.querySelectorAll('.sidebar-submenu > li > .sidebar-sublink').forEach(btn => {
                if(btn.parentElement.parentElement.previousSibling && btn.parentElement.parentElement.previousSibling.textContent === currentMainCat && btn.textContent === currentSubCat) btn.classList.add('active');
            });

            if (!currentMainCat && !currentSubCat) {
                grid.innerHTML = "<div style='grid-column: 1 / -1; text-align: center; color: #888;'>Please select a category on the left.</div>";
                return;
            }

            if (filtered.length === 0) {
                grid.innerHTML = "<div style='grid-column: 1 / -1; text-align: center; color: #888;'>No products found for this category.</div>";
                return;
            }
            filtered.forEach(p => {
                // Make the entire card a hyperlink if amazon_link is present
                if (p.amazon_link) {
                    const cardLink = document.createElement('a');
                    cardLink.className = "product-card-link";
                    cardLink.href = p.amazon_link;
                    cardLink.target = "_blank";
                    cardLink.rel = "noopener";
                    cardLink.tabIndex = 0;
                    cardLink.innerHTML = `
                        <div class="product-card">
                            <div class="product-image-container">
                                <img class="product-image" src="${p.image_url || 'https://via.placeholder.com/220x220?text=No+Image'}" alt="${p.name}">
                            </div>
                            <div class="product-info">
                                <div class="product-title">${p.name}</div>
                                <div class="product-desc">${(p.description || '').replace(/</g, "&lt;").replace(/>/g, "&gt;")}</div>
                                <span class="more-info-btn" tabindex="0">More Info</span>
                            </div>
                        </div>
                    `;
                    // Prevent link from following if clicking the More Info button, allow keyboard accessibility
                    cardLink.querySelector('.more-info-btn').addEventListener('click', e => {
                        e.stopPropagation();
                        window.open(p.amazon_link, "_blank");
                    });
                    grid.appendChild(cardLink);
                } else {
                    // No link: just render card
                    const card = document.createElement('div');
                    card.className = 'product-card';
                    card.innerHTML = `
                        <div class="product-image-container">
                            <img class="product-image" src="${p.image_url || 'https://via.placeholder.com/220x220?text=No+Image'}" alt="${p.name}">
                        </div>
                        <div class="product-info">
                            <div class="product-title">${p.name}</div>
                            <div class="product-desc">${(p.description || '').replace(/</g, "&lt;").replace(/>/g, "&gt;")}</div>
                        </div>
                    `;
                    grid.appendChild(card);
                }
            });
        }

        setupSidebarToggle();
        fetchProducts();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wilderness Essentials UK | Best Camping Gear 2024</title>
    <link rel="icon" type="image/jpeg" href="logo-wilderness-essentials-uk.jpg">
    <style>
        /* ...keep all your previous styles above, then add/replace with: */

        /* NAVBAR STYLES */
        .navbar {
            background: #fff;
            box-shadow: 0 2px 10px rgba(60,90,54,0.07);
            border-bottom: 1.5px solid #ece7e1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0.6rem 1rem 0.6rem 1rem;
            position: relative;
            z-index: 100;
        }
        .nav-list {
            display: flex;
            gap: 1.5rem;
            margin: 0;
            padding: 0;
            list-style: none;
        }
        .nav-item {
            position: relative;
        }
        .nav-link {
            font-weight: 600;
            color: var(--logo-green);
            text-decoration: none;
            background: none;
            border: none;
            font-size: 1.08em;
            padding: 0.48em 1.1em;
            border-radius: 7px;
            cursor: pointer;
            transition: background 0.18s, color 0.18s;
            outline: none;
        }
        .nav-link:hover, .nav-link.active {
            background: var(--accent);
            color: #fff;
        }
        .dropdown-arrow {
            margin-left: 0.35em;
            font-size: 0.83em;
        }
        .dropdown-menu {
            display: none;
            position: absolute;
            top: 110%;
            left: 0;
            background: #fff;
            border: 1.5px solid #e9e4d9;
            box-shadow: 0 6px 24px rgba(60,90,54,0.13);
            border-radius: 10px;
            min-width: 185px;
            padding: 0.7em 0.45em 0.7em 0.45em;
            z-index: 21;
            flex-direction: column;
            gap: 0.28em;
        }
        .nav-item:hover > .dropdown-menu,
        .nav-item:focus-within > .dropdown-menu,
        .dropdown-menu.show {
            display: flex;
        }
        .dropdown-link {
            color: var(--logo-brown);
            background: none;
            border: none;
            font-size: 1em;
            text-align: left;
            padding: 0.48em 1em;
            border-radius: 7px;
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
            transition: background 0.18s, color 0.18s;
        }
        .dropdown-link:hover, .dropdown-link.active {
            background: var(--accent);
            color: #fff;
        }
        @media (max-width: 1000px) {
            .nav-list { gap: 0.65rem; }
            .navbar { padding-left: 0.3em; padding-right: 0.3em;}
        }
        @media (max-width: 650px) {
            .nav-list {
                flex-wrap: wrap;
                gap: 0.2rem;
                justify-content: center;
            }
            .navbar { padding-top: 0.32em; padding-bottom: 0.32em; }
        }
    </style>
</head>
<body>
    <nav class="navbar" id="navbar">
        <!-- Navbar will be dynamically populated here -->
    </nav>
    <!-- ...keep your header, main, etc. -->
    <header>
        <img src="logo-wilderness-essentials-uk.jpg" alt="Wilderness Essentials UK Logo" class="site-logo" />
        <h1>Wilderness Essentials UK</h1>
        <div class="site-tagline">
            Embark on your next adventure with confidence, equipped by Wilderness Essentials UK. We offer a meticulously curated selection of high-quality camping gear, hiking essentials, and outdoor equipment specifically chosen for the diverse landscapes of the United Kingdom.<br><br>
            From robust tents and comfortable sleeping bags to efficient cookware, reliable backpacks, and essential bushcraft tools, find everything you need to thrive in the British wilderness. Explore our range designed for durability, performance, and unforgettable outdoor experiences.
        </div>
    </header>
    <main class="container">
        <div class="products-grid" id="productsGrid"></div>
    </main>
    <script>
        const SHEET_ID = "1w6NcZ9OPhjLcZtgK98ypsxM9eV13NLT9hOf4AVe5HR4";
        const API_KEY = "AIzaSyABNGnLmTXlik5fgBe_ooBI1Y5nrXKTePY";
        const RANGE = "Sheet1";
        let allProducts = [];
        let categoryMap = {};
        let currentMainCat = '';
        let currentSubCat = '';

        async function fetchProducts() {
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=${API_KEY}`;
            try {
                const response = await fetch(url);
                const data = await response.json();
                if (!data.values) {
                    throw new Error(data.error ? data.error.message : 'No data returned');
                }
                const [headers, ...rows] = data.values;
                allProducts = rows.map(row => {
                    const p = {};
                    headers.forEach((h, i) => p[h] = row[i] || "");
                    let [main, sub] = (p.category || '').split('>').map(x => x.trim());
                    p.mainCat = main || '';
                    p.subCat = sub || '';
                    return p;
                });
                buildCategoryMap();
                buildNavbar();
                // Set default selection to first main/sub cat
                if (!currentMainCat) currentMainCat = Object.keys(categoryMap)[0];
                if (!currentSubCat) currentSubCat = (categoryMap[currentMainCat] && categoryMap[currentMainCat][0]) || '';
                renderProducts();
            } catch (err) {
                document.getElementById('productsGrid').innerHTML = `<div style="color:red;text-align:center;">Failed to load products: ${err.message}</div>`;
                console.error(err);
            }
        }

        function buildCategoryMap() {
            categoryMap = {};
            allProducts.forEach(p => {
                if (!p.mainCat) return;
                if (!categoryMap[p.mainCat]) categoryMap[p.mainCat] = new Set();
                if (p.subCat) categoryMap[p.mainCat].add(p.subCat);
            });
            for (let main in categoryMap) {
                categoryMap[main] = Array.from(categoryMap[main]);
            }
        }

        function buildNavbar() {
            const navbar = document.getElementById('navbar');
            navbar.innerHTML = '';
            const navList = document.createElement('ul');
            navList.className = 'nav-list';

            Object.entries(categoryMap).forEach(([main, subcats]) => {
                const navItem = document.createElement('li');
                navItem.className = 'nav-item';

                // If there are subcategories, make dropdown
                if (subcats.length > 0) {
                    const navBtn = document.createElement('button');
                    navBtn.className = 'nav-link' + (currentMainCat === main ? ' active' : '');
                    navBtn.innerHTML = `${main} <span class="dropdown-arrow">▼</span>`;
                    navBtn.tabIndex = 0;
                    navBtn.onclick = (e) => {
                        e.preventDefault();
                        currentMainCat = main;
                        currentSubCat = subcats[0];
                        renderProducts();
                        // Show dropdown on click for mobile
                        closeAllDropdowns();
                        navItem.querySelector('.dropdown-menu').classList.toggle('show');
                    };

                    // Dropdown menu
                    const dropdownMenu = document.createElement('div');
                    dropdownMenu.className = 'dropdown-menu';
                    subcats.forEach(sub => {
                        const subBtn = document.createElement('button');
                        subBtn.className = 'dropdown-link' + (currentMainCat === main && currentSubCat === sub ? ' active' : '');
                        subBtn.textContent = sub;
                        subBtn.onclick = (ev) => {
                            ev.preventDefault();
                            currentMainCat = main;
                            currentSubCat = sub;
                            renderProducts();
                            closeAllDropdowns();
                        };
                        dropdownMenu.appendChild(subBtn);
                    });

                    navItem.appendChild(navBtn);
                    navItem.appendChild(dropdownMenu);

                    // Keyboard accessibility
                    navBtn.addEventListener('keydown', e => {
                        if (e.key === "Enter" || e.key === " ") {
                            e.preventDefault();
                            dropdownMenu.classList.toggle('show');
                        }
                    });
                } else {
                    // No subcats: direct link
                    const navLink = document.createElement('button');
                    navLink.className = 'nav-link' + (currentMainCat === main ? ' active' : '');
                    navLink.textContent = main;
                    navLink.onclick = (e) => {
                        e.preventDefault();
                        currentMainCat = main;
                        currentSubCat = '';
                        renderProducts();
                        closeAllDropdowns();
                    };
                    navItem.appendChild(navLink);
                }
                navList.appendChild(navItem);
            });
            navbar.appendChild(navList);

            // Close dropdowns if click outside
            document.addEventListener('click', closeAllDropdowns);
            navbar.addEventListener('click', e => e.stopPropagation()); // Don't close when clicking inside navbar
        }

        function closeAllDropdowns() {
            document.querySelectorAll('.dropdown-menu').forEach(menu => menu.classList.remove('show'));
        }

        function renderProducts() {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = '';
            let filtered = allProducts.filter(p => {
                if (currentMainCat && currentSubCat) {
                    return p.mainCat === currentMainCat && p.subCat === currentSubCat;
                } else if (currentMainCat) {
                    return p.mainCat === currentMainCat;
                }
                return true;
            });
            if (filtered.length === 0) {
                grid.innerHTML = "<div style='grid-column: 1 / -1; text-align: center; color: #888;'>No products found for this category.</div>";
                return;
            }
            filtered.forEach(p => {
                const card = document.createElement('div');
                card.className = 'product-card';
                card.innerHTML = `
                    <div class="product-image-container">
                        <img class="product-image" src="${p.image_url || 'https://via.placeholder.com/220x220?text=No+Image'}" alt="${p.name}">
                    </div>
                    <div class="product-info">
                        <div class="product-title">${p.name}</div>
                        <div class="product-desc">${(p.description || '').replace(/</g, "&lt;").replace(/>/g, "&gt;")}</div>
                        ${p.amazon_link ? `<a class="more-info-btn" href="${p.amazon_link}" target="_blank" rel="noopener">More Info</a>` : ''}
                    </div>
                `;
                grid.appendChild(card);
            });
            // Update nav active states
            document.querySelectorAll('.nav-link').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.dropdown-link').forEach(btn => btn.classList.remove('active'));
            let navMainBtns = Array.from(document.querySelectorAll('.nav-link'));
            let navSubBtns = Array.from(document.querySelectorAll('.dropdown-link'));
            navMainBtns.forEach(btn => {
                if (btn.textContent.trim() === currentMainCat) btn.classList.add('active');
            });
            navSubBtns.forEach(btn => {
                if (btn.textContent.trim() === currentSubCat) btn.classList.add('active');
            });
        }

        fetchProducts();
    </script>
    <p style="text-align:center;font-size:0.95em;color:#aaa;margin:2em 0 1em 0;">2025 Wilderness Essentials UK © All Rights Reserved.</p>
</body>
</html>

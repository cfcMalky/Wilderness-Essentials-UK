<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Wilderness Essentials UK | Best Camping Gear 2024</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;700;900&display=swap" rel="stylesheet">
  <link rel="icon" type="image/jpeg" href="logo-wilderness-essentials-uk.jpg">
  <style>
    /* ... (keep all your previous CSS, including the new wider product cards and 3 columns) ... */
    /* (for brevity not repeating here, use your last working CSS) */
    /* Add a little style for the error message: */
    .fetch-error {
      color: #a00;
      background: #fff4f4;
      border: 1px solid #a00;
      border-radius: 10px;
      padding: 1.5rem 1rem;
      margin: 2rem auto;
      max-width: 670px;
      text-align: center;
      font-weight: bold;
      font-size: 1.15rem;
      box-shadow: 0 1px 6px #a004;
    }
  </style>
</head>
<body>
  <div class="background-float" aria-hidden="true"></div>
  <button id="sidebarToggle" class="sidebar-toggle-btn" aria-label="Open menu">☰ Menu</button>
  <div class="layout">
    <nav class="sidebar" id="sidebar" aria-label="Categories">
      <a href="#" id="logoHomeLink">
        <img src="logo-wilderness-essentials-uk.jpg" alt="Wilderness Essentials UK Logo" class="sidebar-logo" />
      </a>
      <ul class="sidebar-menu"></ul>
    </nav>
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    <div class="main-content">
      <header>
        <div id="heroCarousel" class="hero-carousel-container"></div>
        <span class="page-title">Wilderness Essentials UK</span>
      </header>
      <div id="homepageContent">
        <div class="site-tagline">
          Embark on your next adventure with confidence, equipped by Wilderness Essentials UK. We offer a meticulously curated selection of high-quality camping gear, hiking essentials, and outdoor equipment specifically chosen for the diverse landscapes of the United Kingdom.<br><br>
          From robust tents and comfortable sleeping bags to efficient cookware, reliable backpacks, and essential bushcraft tools, find everything you need to thrive in the British wilderness. Explore our range designed for durability, performance, and unforgettable outdoor experiences.
        </div>
        <div class="outstanding-content-block">
          <strong>Adventure Tips & Inspiration</strong><br>
          <ul style="margin-top:0.7em;">
            <li><b>Plan Your Escape:</b> Research the area, check the weather, and let someone know your route before heading out.</li>
            <li><b>Pack Smart:</b> Prioritize essentials like shelter, sleeping gear, food/water, and first aid. Don’t forget eco-friendly supplies!</li>
            <li><b>Leave No Trace:</b> Respect nature—take rubbish home, minimize campfire impact, and leave wild spaces better than you found them.</li>
            <li><b>Explore the UK:</b> From the Lake District’s rugged peaks to the Scottish Highlands’ wild beauty, the UK offers endless adventure. Find your next destination!</li>
          </ul>
          <div style="margin-top:1.3em; font-size:1.07em; color:#47613a; font-style:italic;">
            “The wilderness holds answers to more questions than we have yet learned to ask.” – Nancy Wynne Newhall
          </div>
        </div>
      </div>
      <div id="fetchError" class="fetch-error" style="display:none;"></div>
      <main class="container">
        <div class="products-grid" id="productsGrid"></div>
      </main>
      <p style="text-align:center;font-size:0.95em;color:#aaa;margin:2em 0 1em 0;">2025 Wilderness Essentials UK © All Rights Reserved.</p>
    </div>
  </div>
  <script>
    const SHEET_ID = "1w6NcZ9OPhjLcZtgK98ypsxM9eV13NLT9hOf4AVe5HR4";
    const API_KEY = "AIzaSyABNGnLmTXlik5fgBe_ooBI1Y5nrXKTePY";
    const RANGE = "Sheet1";
    const subcatTitles = { "Dome": "Dome Tents", "Tunnel": "Tunnel Tents", "Air Beds": "Air Beds" };
    let allProducts = [];
    let categoryMap = {};
    let currentMainCat = '';
    let currentSubCat = '';

    function setupSidebarToggle() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebarOverlay');
      const toggle = document.getElementById('sidebarToggle');
      function openSidebar() {
        sidebar.classList.add('open');
        overlay.style.display = 'block';
        document.body.style.overflow = 'hidden';
      }
      function closeSidebar() {
        sidebar.classList.remove('open');
        overlay.style.display = 'none';
        document.body.style.overflow = '';
      }
      toggle.onclick = openSidebar;
      overlay.onclick = closeSidebar;
      sidebar.onclick = function(e) {
        if(window.innerWidth <= 950 && (e.target.classList.contains('sidebar-link') || e.target.classList.contains('sidebar-sublink'))) {
          closeSidebar();
        }
      };
      window.addEventListener('resize', () => {
        if(window.innerWidth > 950) closeSidebar();
      });
    }

    async function fetchProducts() {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=${API_KEY}`;
      try {
        const response = await fetch(url);
        const data = await response.json();
        if (!data.values) throw new Error(data.error ? data.error.message : 'No data returned');
        const [headers, ...rows] = data.values;
        allProducts = rows.map(row => {
          const p = {};
          headers.forEach((h, i) => p[h] = row[i] || "");
          let [main, sub] = (p.category || '').split('>').map(x => x.trim());
          if (sub && subcatTitles[sub]) sub = subcatTitles[sub];
          p.mainCat = main || '';
          p.subCat = sub || '';
          return p;
        });
        buildCategoryMap();
        buildSidebar();
        buildHeroCarousel();
        renderProducts();
      } catch (err) {
        showFetchError("Failed to load products: " + err.message);
        buildSidebar(true);
        buildHeroCarousel(true);
        renderProducts(); // Still render homepage
        console.error(err);
      }
    }

    function showFetchError(msg) {
      const fetchErr = document.getElementById('fetchError');
      fetchErr.textContent = msg;
      fetchErr.style.display = "";
    }

    function hideFetchError() {
      const fetchErr = document.getElementById('fetchError');
      fetchErr.textContent = "";
      fetchErr.style.display = "none";
    }

    function buildCategoryMap() {
      categoryMap = {};
      allProducts.forEach(p => {
        if (!p.mainCat) return;
        if (!categoryMap[p.mainCat]) categoryMap[p.mainCat] = new Set();
        if (p.subCat) categoryMap[p.mainCat].add(p.subCat);
      });
      for (let main in categoryMap) {
        categoryMap[main] = Array.from(categoryMap[main]);
      }
    }

    function buildSidebar(error) {
      const menu = document.querySelector('.sidebar-menu');
      menu.innerHTML = '';
      if (error) {
        menu.innerHTML = `<li style="color:#a00;text-align:center;">Navigation unavailable</li>`;
        return;
      }
      Object.entries(categoryMap).forEach(([main, subcats]) => {
        const mainLi = document.createElement('li');
        const mainBtn = document.createElement('div');
        mainBtn.className = 'sidebar-parentcat';
        mainBtn.textContent = main;
        mainLi.appendChild(mainBtn);
        if (subcats.length > 0) {
          const subList = document.createElement('ul');
          subList.className = 'sidebar-submenu';
          subcats.forEach(sub => {
            const subBtnLi = document.createElement('li');
            const subBtn = document.createElement('button');
            subBtn.className = 'sidebar-sublink' + (currentMainCat === main && currentSubCat === sub ? ' active' : '');
            subBtn.textContent = sub;
            subBtn.onclick = function(e) {
              e.preventDefault();
              currentMainCat = main;
              currentSubCat = sub;
              hideFetchError();
              renderProducts();
            };
            subBtnLi.appendChild(subBtn);
            subList.appendChild(subBtnLi);
          });
          mainLi.appendChild(subList);
        }
        menu.appendChild(mainLi);
      });
    }

    // --- HERO CAROUSEL ---
    function buildHeroCarousel(error) {
      const hero = document.getElementById("heroCarousel");
      if (error) {
        hero.innerHTML = `<div style="color:#a00;text-align:center;padding:2em;font-size:1.2em;">Unable to load featured products</div>`;
        return;
      }
      let slides = [];
      let seenSubCat = {};
      for (const p of allProducts) {
        if (!p.image_url || !p.mainCat || !p.subCat || seenSubCat[p.subCat]) continue;
        slides.push({
          image: p.image_url,
          headline: p.subCat,
          mainCat: p.mainCat,
          subCat: p.subCat,
          desc: p.description ? p.description.split('.').slice(0,2).join('.') : '',
        });
        seenSubCat[p.subCat] = true;
        if (slides.length >= 5) break;
      }
      if (slides.length < 3) {
        for (const p of allProducts) {
          if (!p.image_url) continue;
          slides.push({
            image: p.image_url,
            headline: p.name,
            mainCat: p.mainCat,
            subCat: p.subCat,
            desc: p.description ? p.description.split('.').slice(0,2).join('.') : '',
          });
          if (slides.length >= 5) break;
        }
      }
      if (slides.length === 0) {
        hero.innerHTML = `<div style="color:#a00;text-align:center;padding:2em;font-size:1.2em;">No featured products</div>`;
        return;
      }
      hero.innerHTML = "";
      for (let i=0; i<slides.length; ++i) {
        const s = slides[i];
        const slide = document.createElement('div');
        slide.className = "hero-carousel-slide" + (i===0 ? " active" : "");
        slide.innerHTML = `
          <img class="hero-carousel-image" src="${s.image}" alt="">
          <div class="hero-carousel-content">
            <div class="hero-carousel-title">${s.headline}</div>
            <div class="hero-carousel-desc">${s.desc}</div>
            <button class="hero-carousel-cta" type="button" data-maincat="${encodeURIComponent(s.mainCat)}" data-subcat="${encodeURIComponent(s.subCat)}">Shop ${s.headline}</button>
          </div>
        `;
        hero.appendChild(slide);
      }
      // Dots nav
      const nav = document.createElement('div');
      nav.className = "hero-carousel-nav";
      for (let i=0; i<slides.length; ++i) {
        const dot = document.createElement('button');
        dot.className = "hero-carousel-dot" + (i===0 ? " active" : "");
        dot.setAttribute("aria-label", `Show slide ${i+1}`);
        dot.onclick = () => setHeroCarouselSlide(i);
        nav.appendChild(dot);
      }
      hero.appendChild(nav);
      // Attach event listeners for the CTA buttons
      hero.querySelectorAll('.hero-carousel-cta').forEach(btn => {
        btn.addEventListener('click', function() {
          const mainCat = decodeURIComponent(this.getAttribute('data-maincat'));
          const subCat = decodeURIComponent(this.getAttribute('data-subcat'));
          if (mainCat && subCat) {
            currentMainCat = mainCat;
            currentSubCat = subCat;
            hideFetchError();
            renderProducts();
            document.getElementById('productsGrid').scrollIntoView({behavior: 'smooth', block: 'start'});
          }
        });
      });
      // State
      let current = 0;
      let timer = null;
      function setHeroCarouselSlide(idx) {
        const slidesEls = hero.querySelectorAll('.hero-carousel-slide');
        const dotsEls = hero.querySelectorAll('.hero-carousel-dot');
        slidesEls.forEach((el, i) => {
          el.classList.toggle('active', i === idx);
        });
        dotsEls.forEach((el, i) => {
          el.classList.toggle('active', i === idx);
        });
        current = idx;
        resetTimer();
      }
      function nextSlide() {
        setHeroCarouselSlide((current+1)%slides.length);
      }
      function resetTimer() {
        if (timer) clearInterval(timer);
        timer = setInterval(nextSlide, 5500);
      }
      resetTimer();
    }

    function renderProducts() {
      const grid = document.getElementById('productsGrid');
      const homepageContent = document.getElementById('homepageContent');
      // Home page: show welcome/tips if nothing selected
      if (!currentMainCat && !currentSubCat) {
        homepageContent.style.display = "";
        grid.style.display = "none";
        grid.innerHTML = "";
        return;
      }
      // Category selected: hide welcome/tips, show products
      homepageContent.style.display = "none";
      grid.style.display = "";
      grid.innerHTML = '';
      let filtered = allProducts.filter(p => p.mainCat === currentMainCat && p.subCat === currentSubCat);
      document.querySelectorAll('.sidebar-sublink').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.sidebar-menu > li').forEach(li => {
        li.querySelectorAll('.sidebar-parentcat').forEach(btn => btn.classList.remove('active'));
      });
      document.querySelectorAll('.sidebar-submenu > li > .sidebar-sublink').forEach(btn => {
        if(btn.parentElement.parentElement.previousSibling && btn.parentElement.parentElement.previousSibling.textContent === currentMainCat && btn.textContent === currentSubCat) btn.classList.add('active');
      });

      if (filtered.length === 0) {
        grid.innerHTML = "<div style='grid-column: 1 / -1; text-align: center; color: #888;'>No products found for this category.</div>";
        return;
      }
      filtered.forEach(p => {
        if (p.amazon_link) {
          const cardLink = document.createElement('a');
          cardLink.className = "product-card-link";
          cardLink.href = p.amazon_link;
          cardLink.target = "_blank";
          cardLink.rel = "noopener";
          cardLink.tabIndex = 0;
          cardLink.innerHTML = `
            <div class="product-card">
              <div class="product-image-container">
                <img class="product-image" src="${p.image_url || 'https://via.placeholder.com/220x220?text=No+Image'}" alt="${p.name}">
              </div>
              <div class="product-info">
                <div class="product-title">${p.name}</div>
                <div class="product-desc">${(p.description || '').replace(/</g, "&lt;").replace(/>/g, "&gt;")}</div>
                <span class="more-info-btn" tabindex="0">More Info</span>
              </div>
            </div>
          `;
          cardLink.querySelector('.more-info-btn').addEventListener('click', e => {
            e.stopPropagation();
            window.open(p.amazon_link, "_blank");
          });
          grid.appendChild(cardLink);
        } else {
          const card = document.createElement('div');
          card.className = 'product-card';
          card.innerHTML = `
            <div class="product-image-container">
              <img class="product-image" src="${p.image_url || 'https://via.placeholder.com/220x220?text=No+Image'}" alt="${p.name}">
            </div>
            <div class="product-info">
              <div class="product-title">${p.name}</div>
              <div class="product-desc">${(p.description || '').replace(/</g, "&lt;").replace(/>/g, "&gt;")}</div>
            </div>
          `;
          grid.appendChild(card);
        }
      });
    }

    setupSidebarToggle();
    fetchProducts();

    // Make logo a home link
    document.addEventListener('DOMContentLoaded', function() {
      const logoHomeLink = document.getElementById('logoHomeLink');
      if(logoHomeLink){
        logoHomeLink.addEventListener('click', function(e){
          e.preventDefault();
          currentMainCat = '';
          currentSubCat = '';
          hideFetchError();
          renderProducts();
          window.scrollTo({ top: 0, behavior: 'smooth' });
        });
      }
    });
  </script>
</body>
</html>

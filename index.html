<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Wilderness Essentials UK: Your Definitive Guide to the UK's Hottest Selling Outdoor Gear.</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;700;900&display=swap" rel="stylesheet">
  <link rel="icon" type="image/jpeg" href="logo-wilderness-essentials-uk.jpg">
  <style>
    :root {
      --logo-green: #3c5a36;
      --logo-brown: #6b4a2b;
      --logo-gold: #c9a14a;
      --primary: #3c5a36;
      --secondary: #6b4a2b;
      --accent: #c9a14a;
      --bg-pastel: #f6f7f2;
      --header-text: #3c5a36;
      --card-shadow: 0 8px 32px rgba(60,90,54,0.09), 0 1.5px 6px rgba(105,74,43,0.08);
      --card-shadow-hover: 0 12px 36px rgba(60,90,54,0.13), 0 4px 16px rgba(105,74,43,0.12);
      --border-radius: 18px;
    }
    html, body {
      font-size: 16px;
      height: 100%;
      min-height: 100%;
    }
    body {
      font-family: 'Quicksand', 'Segoe UI', Arial, Verdana, sans-serif;
      background: var(--bg-pastel);
      color: var(--logo-brown);
      margin: 0;
      overflow-x: hidden;
      height: 100%;
    }
    .background-float {
      position: fixed;
      right: 0;
      bottom: 0;
      top: 0;
      left: 0;
      z-index: 0;
      pointer-events: none;
      background: url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1200&q=80') no-repeat right bottom;
      background-size: cover;
      opacity: 0.12;
      filter: blur(0.5px) grayscale(0.3) brightness(1.1);
    }
    .layout {
      display: flex;
      min-height: 100vh;
      position: relative;
      z-index: 1;
      height: 100vh;
    }
    .sidebar {
      width: 250px;
      background: #fff;
      border-right: 2px solid var(--logo-gold);
      padding: 2rem 1rem 1rem 1rem;
      box-shadow: 2px 0 14px rgba(60,90,54,0.08);
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      height: 100vh;
      overflow-y: auto;
      overflow-x: hidden;
      z-index: 200;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .sidebar-logo {
      display: block;
      margin: 0 0 2rem 0;
      width: 100%;
      max-width: 100%;
      min-width: 0;
      height: 180px;
      max-height: 180px;
      object-fit: contain;
      border-radius: 14px;
      background: #fff;
      padding: 0;
      box-shadow: 0 2px 8px rgba(60,90,54,0.07);
      transition: box-shadow 0.2s;
    }
    .sidebar-logo:hover {
      box-shadow: 0 4px 16px rgba(60,90,54,0.13);
      background: #f6f7f2;
    }
    @media (max-width: 600px) {
      .sidebar-logo {
        max-height: 54px;
        height: 54px;
      }
    }
    .sidebar-menu,
    .sidebar-submenu {
      list-style: none;
      padding: 0;
      margin: 0;
      width: 100%;
    }
    .sidebar-menu > li {
      margin-bottom: 1.1em;
    }
    .sidebar-parentcat {
      display: block;
      width: 100%;
      background: var(--logo-green);
      color: #fff;
      font-weight: 700;
      font-size: 1.15rem;
      text-align: left;
      padding: 0.55em 0.7em;
      border-radius: 8px !important;
      margin-bottom: 0.12em;
      border: none;
      cursor: default;
      letter-spacing: 0.01em;
      outline: none;
      pointer-events: none;
      box-shadow: none;
      opacity: 1;
      white-space: normal;
      overflow: visible;
      position: relative;
      z-index: 1;
    }
    .sidebar-link, .sidebar-sublink {
      display: block;
      width: 100%;
      background: none;
      border: none;
      color: var(--logo-green);
      font-weight: 600;
      font-size: 1.04rem;
      text-align: left;
      padding: 0.4em 0.7em;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.18s, color 0.18s;
      text-decoration: none;
      margin-bottom: 0.12em;
      white-space: normal;
      overflow: visible;
    }
    .sidebar-link.active,
    .sidebar-link:hover {
      background: var(--accent);
      color: #fff;
    }
    .sidebar-submenu {
      margin-left: 0.6em;
      margin-top: 0.2em;
      background: none;
      border-radius: 0 0 8px 8px;
      padding-bottom: 0.2em;
    }
    .sidebar-sublink.active {
      background: var(--logo-gold) !important;
      color: #fff !important;
      border-radius: 5px;
    }
    .sidebar-sublink {
      color: var(--logo-brown);
      font-weight: 500;
      font-size: 0.98rem;
      border-radius: 5px;
      padding: 0.34em 0.7em;
      background: none;
      white-space: normal;
      position: relative;
      z-index: 0;
    }
    .sidebar-toggle-btn {
      display: none;
      position: fixed;
      left: 15px;
      top: 15px;
      z-index: 300;
      background: var(--logo-gold);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 0.6em 1em;
      font-size: 1.2em;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(60,90,54,0.10);
    }
    @media (max-width: 950px) {
      .sidebar {
        position: fixed;
        left: -265px;
        top: 0;
        height: 100vh;
        min-height: 100vh;
        z-index: 2000;
        transition: left 0.28s;
      }
      .sidebar.open {
        left: 0;
        box-shadow: 2px 0 15px rgba(60,90,54,0.14);
      }
      .sidebar-toggle-btn {
        display: block;
      }
      .layout {
        flex-direction: column;
      }
      .main-content {
        margin-left: 0;
      }
    }
    .main-content {
      flex: 1 1 auto;
      padding: 0;
      margin-left: 250px;
      min-width: 0;
    }
    .sidebar-overlay {
      display: none;
      position: fixed;
      left: 0; top: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(60,90,54,0.22);
      z-index: 1000;
    }
    .sidebar.open ~ .sidebar-overlay {
      display: block;
    }

    /* --- HERO CAROUSEL --- */
    .hero-carousel-container {
      width: 100%;
      max-width: 1100px;
      margin: 2rem auto 2.5rem auto;
      position: relative;
      z-index: 3;
      min-height: 470px;
      height: 470px;
      display: flex;
      align-items: center;
    }
    .hero-carousel-slide {
      display: none;
      position: absolute;
      width: 100%;
      height: 470px;
      left: 0; top: 0;
      border-radius: 28px;
      overflow: hidden;
      background: #eee;
      box-shadow: 0 2px 24px rgba(60,90,54,0.12);
      transition: opacity 0.7s;
    }
    .hero-carousel-slide.active {
      display: flex;
      opacity: 1;
      z-index: 2;
      animation: fadeInScale 1s;
    }
    @keyframes fadeInScale {
      from { opacity: 0; transform: scale(0.98);}
      to { opacity: 1; transform: scale(1);}
    }
    .hero-carousel-image {
      height: 100%;
      width: 55%;
      object-fit: contain;
      object-position: center;
      background: #fafaf7;
      border-radius: 28px 0 0 28px;
    }
    .hero-carousel-content {
      width: 45%;
      padding: 2.7rem 3rem 2.1rem 2.7rem;
      display: flex;
      flex-direction: column;
      justify-content: center;
      background: rgba(255,255,255,0.86);
      border-radius: 0 28px 28px 0;
      font-size: 1.18rem;
    }
    .hero-carousel-title {
      font-size: 2.2rem;
      font-weight: bold;
      color: var(--logo-green);
      margin-bottom: 0.6rem;
      text-shadow: 0 2px 12px rgba(60,90,54,0.08);
    }
    .hero-carousel-desc {
      color: var(--logo-brown);
      margin-bottom: 1.2rem;
      font-size: 1.13rem;
      line-height: 1.45;
    }
    .hero-carousel-cta {
      align-self: flex-start;
      background: var(--logo-gold);
      color: #fff;
      font-size: 1.1rem;
      font-weight: 700;
      border: none;
      border-radius: 8px;
      padding: 0.7rem 1.8rem;
      text-decoration: none;
      cursor: pointer;
      box-shadow: 0 1px 8px rgba(201,161,74,0.08);
      transition: background 0.17s, color 0.17s;
      letter-spacing: 0.01em;
    }
    .hero-carousel-cta:hover {
      background: var(--logo-green);
      color: #fff;
    }
    .hero-carousel-nav {
      position: absolute;
      left: 18px;
      bottom: 20px;
      display: flex;
      gap: 0.7rem;
      z-index: 10;
    }
    .hero-carousel-dot {
      width: 14px;
      height: 14px;
      background: var(--logo-gold);
      opacity: 0.55;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      transition: background 0.18s, opacity 0.18s;
    }
    .hero-carousel-dot.active {
      background: var(--logo-green);
      opacity: 1;
    }
    @media (max-width: 1200px) {
      .hero-carousel-container,
      .hero-carousel-slide,
      .hero-carousel-slide.active {
        max-width: 98vw;
      }
    }
    @media (max-width: 900px) {
      .hero-carousel-container {
        min-height: 320px;
        height: 370px;
      }
      .hero-carousel-slide,
      .hero-carousel-slide.active {
        flex-direction: column;
        height: 370px;
      }
      .hero-carousel-image,
      .hero-carousel-content {
        width: 100%;
        border-radius: 28px 28px 0 0;
      }
      .hero-carousel-content {
        border-radius: 0 0 28px 28px;
        padding: 1.2rem 1.1rem;
      }
    }
    header {
      background: transparent;
      color: var(--header-text);
      padding: 0 0 1.5rem 0;
      text-align: center;
    }
    .page-title {
      font-size: 3rem;
      font-weight: 900;
      color: #3c5a36;
      width: 670px;
      max-width: 98vw;
      margin: 2rem auto 0.5rem auto;
      line-height: 1.15;
      text-align: center;
      position: relative;
      display: block;
      letter-spacing: 0.01em;
    }
    .page-title::after {
      content: "";
      display: block;
      margin: 0.4em auto 0 auto;
      width: 100%;
      height: 7px;
      background: #c9a14a;
      border-radius: 3px;
    }
    @media (max-width: 700px) {
      .page-title,
      .page-title::after {
        width: 98vw;
        min-width: 0;
      }
    }
    .site-tagline {
      color: #6b4a2b;
      font-size: 1.24rem;
      max-width: 670px;
      margin: 0.7rem auto 0.7rem auto;
      background: none;
      border-radius: 0;
      box-shadow: none;
      padding: 0;
      font-style: italic;
      text-align: center;
      line-height: 1.6;
      position: relative;
    }
    #subcategory-title {
      margin-top: 0.3em;
      font-weight: 900;
      color: #c9a14a;
      font-size: 1.26rem;
      min-height: 1.2em;
      line-height: 1.2;
      text-align: center;
      display: none;
    }
    .site-intro {
      color: #6b4a2b;
      font-size: 1.13rem;
      margin: 0.5rem auto 0 auto;
      width: 670px;
      max-width: 98vw;
      line-height: 1.7;
      background: #fff8ee;
      border-radius: 13px;
      padding: 1.1rem 1.5rem;
      box-shadow: 0 1px 7px rgba(201,161,74,0.06);
      text-align: left;
    }
    .outstanding-content-block {
      max-width: 670px;
      margin: 2.2rem auto;
      background: #f5f7eb;
      border-radius: 14px;
      box-shadow: 0 1px 7px rgba(60,90,54,0.09);
      padding: 2rem;
      color: #2d3c1e;
      font-size: 1.14rem;
      text-align: left;
      border-left: 7px solid #c9a14a;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem 1rem;
      position: relative;
      z-index: 1;
    }
    .products-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 2.5rem 2rem;
      align-items: stretch;
      justify-items: center;
    }
    @media (max-width: 1200px) {
      .products-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    @media (max-width: 800px) {
      .products-grid {
        grid-template-columns: 1fr;
      }
    }
    .product-card-link {
      text-decoration: none;
      color: inherit;
      display: block;
      width: 100%;
      max-width: 550px;
      min-width: 0;
      min-height: 430px;
    }
    .product-card {
      background: #fff;
      border-radius: var(--border-radius);
      box-shadow: var(--card-shadow);
      display: flex;
      flex-direction: column;
      width: 100%;
      min-width: 0;
      min-height: 430px;
      max-width: 550px;
      transition: box-shadow 0.24s, transform 0.18s;
      overflow: hidden;
      border: 1.5px solid #ece7e1;
      position: relative;
      cursor: pointer;
    }
    .product-card:hover, .product-card-link:focus .product-card {
      box-shadow: var(--card-shadow-hover);
      border-color: var(--logo-gold);
      transform: translateY(-5px) scale(1.012);
    }
    .product-image-container {
      width: 100%;
      height: 220px;
      background: #faf8f3;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px 10px 18px 10px;
      box-sizing: border-box;
      border-bottom: 1px solid #f2ecdf;
    }
    .product-image {
      max-width: 100%;
      max-height: 100%;
      height: auto;
      width: auto;
      object-fit: contain;
      display: block;
      background: #fff;
      border-radius: 11px;
      box-shadow: 0 1px 5px rgba(60,90,54,0.06);
    }
    .product-info {
      flex: 1 1 auto;
      padding: 1.2rem 1.2rem 1.6rem 1.2rem;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      min-height: 180px;
      position: relative;
    }
    .product-title {
      font-size: 1.15rem;
      font-weight: bold;
      color: var(--logo-green);
      margin-bottom: 0.7rem;
      min-height: 2.2em;
      line-height: 1.3;
      text-overflow: ellipsis;
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      letter-spacing: 0.01em;
    }
    .product-desc {
      font-size: 1.03rem;
      color: var(--logo-brown);
      margin-bottom: 1.1rem;
      flex: 1 1 auto;
      line-height: 1.51;
      min-height: 5em;
      white-space: pre-line;
    }
    .more-info-btn {
      margin: auto 1rem 0 1rem;
      background: var(--logo-green);
      color: #fff;
      text-decoration: none;
      padding: 0.72rem 1.3rem;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 1.05rem;
      text-align: center;
      cursor: pointer;
      transition: background 0.18s, box-shadow 0.18s;
      box-shadow: 0 1px 5px rgba(60,90,54,0.08);
      display: block;
      width: calc(100% - 2rem);
      box-sizing: border-box;
      letter-spacing: 0.01em;
      position: relative;
      z-index: 2;
    }
    .more-info-btn:hover, .more-info-btn:focus {
      background: var(--accent);
      color: var(--logo-brown);
    }
    .product-card-link:focus .more-info-btn,
    .product-card-link:active .more-info-btn {
      outline: 2px solid var(--accent);
    }
    .fetch-error {
      color: #a00;
      background: #fff4f4;
      border: 1px solid #a00;
      border-radius: 10px;
      padding: 1.5rem 1rem;
      margin: 2rem auto;
      max-width: 670px;
      text-align: center;
      font-weight: bold;
      font-size: 1.15rem;
      box-shadow: 0 1px 6px #a004;
    }
  </style>
</head>
<body>
  <div class="background-float" aria-hidden="true"></div>
  <button id="sidebarToggle" class="sidebar-toggle-btn" aria-label="Open menu">☰ Menu</button>
  <div class="layout">
    <nav class="sidebar" id="sidebar" aria-label="Categories">
      <a href="#" id="logoHomeLink">
        <img src="logo-wilderness-essentials-uk.jpg" alt="Wilderness Essentials UK Logo" class="sidebar-logo" />
      </a>
      <ul class="sidebar-menu"></ul>
    </nav>
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    <div class="main-content">
      <header>
        <div id="heroCarousel" class="hero-carousel-container"></div>
        <span class="page-title">Wilderness Essentials UK</span>
        <div class="site-tagline">
          Your Definitive Guide to the UK's Hottest Selling Outdoor Gear.
          <div id="subcategory-title"></div>
        </div>
      </header>
      <div id="homepageContent">
        <div class="site-intro">
          Embark on your next adventure with confidence, knowing you have the best gear. At Wilderness Essentials UK, we meticulously research and compile the hottest selling and top-rated camping gear, hiking essentials, and outdoor equipment specifically chosen for the diverse landscapes of the United Kingdom.<br><br>
          We cut through the noise to bring you unbiased insights and direct links to products adventurers trust. From robust tents and comfortable sleeping bags to efficient cookware, reliable backpacks, and essential bushcraft tools, discover everything you need to thrive in the British wilderness. Explore our curated selections and confidently equip your next unforgettable outdoor experience.
        </div>
        <div class="outstanding-content-block">
          <strong>Adventure Tips & Inspiration</strong><br>
          <ul style="margin-top:0.7em;">
            <li><b>Plan Your Escape:</b> Research the area, check the weather, and let someone know your route before heading out.</li>
            <li><b>Pack Smart:</b> Prioritize essentials like shelter, sleeping gear, food/water, and first aid. Don’t forget eco-friendly supplies!</li>
            <li><b>Leave No Trace:</b> Respect nature—take rubbish home, minimize campfire impact, and leave wild spaces better than you found them.</li>
            <li><b>Explore the UK:</b> From the Lake District’s rugged peaks to the Scottish Highlands’ wild beauty, the UK offers endless adventure. Find your next destination!</li>
          </ul>
          <div style="margin-top:1.3em; font-size:1.07em; color:#47613a; font-style:italic;">
            “The wilderness holds answers to more questions than we have yet learned to ask.” – Nancy Wynne Newhall
          </div>
        </div>
      </div>
      <div id="fetchError" class="fetch-error" style="display:none;"></div>
      <main class="container">
        <div class="products-grid" id="productsGrid"></div>
      </main>
      <p style="text-align:center;font-size:0.95em;color:#aaa;margin:2em 0 1em 0;">2025 Wilderness Essentials UK © All Rights Reserved.</p>
    </div>
  </div>
  <script>
    const SHEET_ID = "1w6NcZ9OPhjLcZtgK98ypsxM9eV13NLT9hOf4AVe5HR4";
    const API_KEY = "AIzaSyABNGnLmTXlik5fgBe_ooBI1Y5nrXKTePY";
    const RANGE = "Sheet1";
    const subcatTitles = { "Dome": "Dome Tents", "Tunnel": "Tunnel Tents", "Air Beds": "Air Beds" };
    let allProducts = [];
    let categoryMap = {};
    let currentMainCat = '';
    let currentSubCat = '';

    function setupSidebarToggle() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebarOverlay');
      const toggle = document.getElementById('sidebarToggle');
      function openSidebar() {
        sidebar.classList.add('open');
        overlay.style.display = 'block';
        document.body.style.overflow = 'hidden';
      }
      function closeSidebar() {
        sidebar.classList.remove('open');
        overlay.style.display = 'none';
        document.body.style.overflow = '';
      }
      toggle.onclick = openSidebar;
      overlay.onclick = closeSidebar;
      sidebar.onclick = function(e) {
        if(window.innerWidth <= 950 && (e.target.classList.contains('sidebar-link') || e.target.classList.contains('sidebar-sublink'))) {
          closeSidebar();
        }
      };
      window.addEventListener('resize', () => {
        if(window.innerWidth > 950) closeSidebar();
      });
    }

    async function fetchProducts() {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=${API_KEY}`;
      try {
        const response = await fetch(url);
        const data = await response.json();
        if (!data.values) throw new Error(data.error ? data.error.message : 'No data returned');
        const [headers, ...rows] = data.values;
        allProducts = rows.map(row => {
          const p = {};
          headers.forEach((h, i) => p[h] = row[i] || "");
          let [main, sub] = (p.category || '').split('>').map(x => x.trim());
          if (sub && subcatTitles[sub]) sub = subcatTitles[sub];
          p.mainCat = main || '';
          p.subCat = sub || '';
          return p;
        });
        buildCategoryMap();
        buildSidebar();
        buildHeroCarousel();
        renderProducts();
      } catch (err) {
        showFetchError("Failed to load products: " + err.message);
        buildSidebar(true);
        buildHeroCarousel(true);
        renderProducts(); // Still render homepage
        console.error(err);
      }
    }

    function showFetchError(msg) {
      const fetchErr = document.getElementById('fetchError');
      fetchErr.textContent = msg;
      fetchErr.style.display = "";
    }

    function hideFetchError() {
      const fetchErr = document.getElementById('fetchError');
      fetchErr.textContent = "";
      fetchErr.style.display = "none";
    }

    function buildCategoryMap() {
      categoryMap = {};
      allProducts.forEach(p => {
        if (!p.mainCat) return;
        if (!categoryMap[p.mainCat]) categoryMap[p.mainCat] = new Set();
        if (p.subCat) categoryMap[p.mainCat].add(p.subCat);
      });
      for (let main in categoryMap) {
        categoryMap[main] = Array.from(categoryMap[main]);
      }
    }

    function buildSidebar(error) {
      const menu = document.querySelector('.sidebar-menu');
      menu.innerHTML = '';
      if (error) {
        menu.innerHTML = `<li style="color:#a00;text-align:center;">Navigation unavailable</li>`;
        return;
      }
      Object.entries(categoryMap).forEach(([main, subcats]) => {
        const mainLi = document.createElement('li');
        const mainBtn = document.createElement('div');
        mainBtn.className = 'sidebar-parentcat';
        mainBtn.textContent = main;
        mainLi.appendChild(mainBtn);
        if (subcats.length > 0) {
          const subList = document.createElement('ul');
          subList.className = 'sidebar-submenu';
          subcats.forEach(sub => {
            const subBtnLi = document.createElement('li');
            const subBtn = document.createElement('button');
            subBtn.className = 'sidebar-sublink' + (currentMainCat === main && currentSubCat === sub ? ' active' : '');
            subBtn.textContent = sub;
            subBtn.onclick = function(e) {
              e.preventDefault();
              currentMainCat = main;
              currentSubCat = sub;
              hideFetchError();
              renderProducts();
            };
            subBtnLi.appendChild(subBtn);
            subList.appendChild(subBtnLi);
          });
          mainLi.appendChild(subList);
        }
        menu.appendChild(mainLi);
      });
    }

    // --- HERO CAROUSEL ---
    function buildHeroCarousel(error) {
      const hero = document.getElementById("heroCarousel");
      if (error) {
        hero.innerHTML = `<div style="color:#a00;text-align:center;padding:2em;font-size:1.2em;">Unable to load featured products</div>`;
        return;
      }
      let slides = [];
      let seenSubCat = {};
      for (const p of allProducts) {
        if (!p.image_url || !p.mainCat || !p.subCat || seenSubCat[p.subCat]) continue;
        slides.push({
          image: p.image_url,
          headline: p.subCat,
          mainCat: p.mainCat,
          subCat: p.subCat,
          desc: p.description ? p.description.split('.').slice(0,2).join('.') : '',
        });
        seenSubCat[p.subCat] = true;
        if (slides.length >= 5) break;
      }
      if (slides.length < 3) {
        for (const p of allProducts) {
          if (!p.image_url) continue;
          slides.push({
            image: p.image_url,
            headline: p.name,
            mainCat: p.mainCat,
            subCat: p.subCat,
            desc: p.description ? p.description.split('.').slice(0,2).join('.') : '',
          });
          if (slides.length >= 5) break;
        }
      }
      if (slides.length === 0) {
        hero.innerHTML = `<div style="color:#a00;text-align:center;padding:2em;font-size:1.2em;">No featured products</div>`;
        return;
      }
      hero.innerHTML = "";
      for (let i=0; i<slides.length; ++i) {
        const s = slides[i];
        const slide = document.createElement('div');
        slide.className = "hero-carousel-slide" + (i===0 ? " active" : "");
        slide.innerHTML = `
          <img class="hero-carousel-image" src="${s.image}" alt="">
          <div class="hero-carousel-content">
            <div class="hero-carousel-title">${s.headline}</div>
            <div class="hero-carousel-desc">${s.desc}</div>
            <button class="hero-carousel-cta" type="button" data-maincat="${encodeURIComponent(s.mainCat)}" data-subcat="${encodeURIComponent(s.subCat)}">Shop ${s.headline}</button>
          </div>
        `;
        hero.appendChild(slide);
      }
      // Dots nav
      const nav = document.createElement('div');
      nav.className = "hero-carousel-nav";
      for (let i=0; i<slides.length; ++i) {
        const dot = document.createElement('button');
        dot.className = "hero-carousel-dot" + (i===0 ? " active" : "");
        dot.setAttribute("aria-label", `Show slide ${i+1}`);
        dot.onclick = () => setHeroCarouselSlide(i);
        nav.appendChild(dot);
      }
      hero.appendChild(nav);
      // Attach event listeners for the CTA buttons
      hero.querySelectorAll('.hero-carousel-cta').forEach(btn => {
        btn.addEventListener('click', function() {
          const mainCat = decodeURIComponent(this.getAttribute('data-maincat'));
          const subCat = decodeURIComponent(this.getAttribute('data-subcat'));
          if (mainCat && subCat) {
            currentMainCat = mainCat;
            currentSubCat = subCat;
            hideFetchError();
            renderProducts();
            document.getElementById('productsGrid').scrollIntoView({behavior: 'smooth', block: 'start'});
          }
        });
      });
      // State
      let current = 0;
      let timer = null;
      function setHeroCarouselSlide(idx) {
        const slidesEls = hero.querySelectorAll('.hero-carousel-slide');
        const dotsEls = hero.querySelectorAll('.hero-carousel-dot');
        slidesEls.forEach((el, i) => {
          el.classList.toggle('active', i === idx);
        });
        dotsEls.forEach((el, i) => {
          el.classList.toggle('active', i === idx);
        });
        current = idx;
        resetTimer();
      }
      function nextSlide() {
        setHeroCarouselSlide((current+1)%slides.length);
      }
      function resetTimer() {
        if (timer) clearInterval(timer);
        timer = setInterval(nextSlide, 5500);
      }
      resetTimer();
    }

    function updateSubcategoryTitle() {
      const el = document.getElementById('subcategory-title');
      if (currentMainCat && currentSubCat) {
        el.textContent = currentMainCat + " > " + currentSubCat;
        el.style.display = '';
      } else if (currentMainCat) {
        el.textContent = currentMainCat;
        el.style.display = '';
      } else if (currentSubCat) {
        el.textContent = currentSubCat;
        el.style.display = '';
      } else {
        el.textContent = '';
        el.style.display = 'none';
      }
    }

    function renderProducts() {
      const grid = document.getElementById('productsGrid');
      const homepageContent = document.getElementById('homepageContent');
      updateSubcategoryTitle();
      // Home page: show welcome/tips if nothing selected
      if (!currentMainCat && !currentSubCat) {
        homepageContent.style.display = "";
        grid.style.display = "none";
        grid.innerHTML = "";
        return;
      }
      // Category selected: hide welcome/tips, show products
      homepageContent.style.display = "none";
      grid.style.display = "";
      grid.innerHTML = '';
      let filtered = allProducts.filter(p => p.mainCat === currentMainCat && p.subCat === currentSubCat);
      document.querySelectorAll('.sidebar-sublink').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.sidebar-menu > li').forEach(li => {
        li.querySelectorAll('.sidebar-parentcat').forEach(btn => btn.classList.remove('active'));
      });
      document.querySelectorAll('.sidebar-submenu > li > .sidebar-sublink').forEach(btn => {
        if(btn.parentElement.parentElement.previousSibling && btn.parentElement.parentElement.previousSibling.textContent === currentMainCat && btn.textContent === currentSubCat) btn.classList.add('active');
      });

      if (filtered.length === 0) {
        grid.innerHTML = "<div style='grid-column: 1 / -1; text-align: center; color: #888;'>No products found for this category.</div>";
        return;
      }
      filtered.forEach(p => {
        if (p.amazon_link) {
          const cardLink = document.createElement('a');
          cardLink.className = "product-card-link";
          cardLink.href = p.amazon_link;
          cardLink.target = "_blank";
          cardLink.rel = "noopener";
          cardLink.tabIndex = 0;
          cardLink.innerHTML = `
            <div class="product-card">
              <div class="product-image-container">
                <img class="product-image" src="${p.image_url || 'https://via.placeholder.com/220x220?text=No+Image'}" alt="${p.name}">
              </div>
              <div class="product-info">
                <div class="product-title">${p.name}</div>
                <div class="product-desc">${(p.description || '').replace(/</g, "&lt;").replace(/>/g, "&gt;")}</div>
                <span class="more-info-btn" tabindex="0">More Info</span>
              </div>
            </div>
          `;
          cardLink.querySelector('.more-info-btn').addEventListener('click', e => {
            e.stopPropagation();
            window.open(p.amazon_link, "_blank");
          });
          grid.appendChild(cardLink);
        } else {
          const card = document.createElement('div');
          card.className = 'product-card';
          card.innerHTML = `
            <div class="product-image-container">
              <img class="product-image" src="${p.image_url || 'https://via.placeholder.com/220x220?text=No+Image'}" alt="${p.name}">
            </div>
            <div class="product-info">
              <div class="product-title">${p.name}</div>
              <div class="product-desc">${(p.description || '').replace(/</g, "&lt;").replace(/>/g, "&gt;")}</div>
            </div>
          `;
          grid.appendChild(card);
        }
      });
    }

    setupSidebarToggle();
    fetchProducts();

    // Make logo a home link
    document.addEventListener('DOMContentLoaded', function() {
      const logoHomeLink = document.getElementById('logoHomeLink');
      if(logoHomeLink){
        logoHomeLink.addEventListener('click', function(e){
          e.preventDefault();
          currentMainCat = '';
          currentSubCat = '';
          hideFetchError();
          renderProducts();
          window.scrollTo({ top: 0, behavior: 'smooth' });
        });
      }
      updateSubcategoryTitle();
    });
  </script>
</body>
</html>
